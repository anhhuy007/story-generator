<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AI Story Generator</title>
		<style>
			:root {
				--primary: #4361ee;
				--secondary: #3a0ca3;
				--light: #f8f9fa;
				--dark: #212529;
				--success: #4cc9f0;
				--error: #ef476f;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				line-height: 1.6;
				color: var(--dark);
				margin: 0;
				padding: 0;
				background-color: #f5f7fa;
			}

			.container {
				width: 100%;
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			header {
				text-align: center;
				padding: 20px 0;
				margin-bottom: 30px;
				background: linear-gradient(135deg, var(--primary), var(--secondary));
				color: white;
				border-radius: 10px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}

			h1 {
				margin: 0;
				font-size: 2.5rem;
			}

			.tagline {
				font-size: 1.2rem;
				opacity: 0.9;
			}

			.generator-form {
				background-color: white;
				padding: 30px;
				border-radius: 10px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
				margin-bottom: 30px;
			}

			.form-group {
				margin-bottom: 20px;
			}

			label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
			}

			textarea,
			input {
				width: 100%;
				padding: 12px;
				border: 1px solid #ddd;
				border-radius: 5px;
				font-size: 16px;
			}

			textarea {
				min-height: 120px;
				resize: vertical;
			}

			button {
				background-color: var(--primary);
				color: white;
				border: none;
				padding: 12px 24px;
				font-size: 18px;
				border-radius: 5px;
				cursor: pointer;
				transition: background-color 0.3s;
				width: 100%;
				font-weight: 600;
			}

			button:hover {
				background-color: var(--secondary);
			}

			button:disabled {
				background-color: #cccccc;
				cursor: not-allowed;
			}

			.loading {
				display: none;
				text-align: center;
				margin: 20px 0;
			}

			.spinner {
				border: 5px solid #f3f3f3;
				border-top: 5px solid var(--primary);
				border-radius: 50%;
				width: 50px;
				height: 50px;
				animation: spin 1s linear infinite;
				margin: 0 auto;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			.story-container {
				display: none;
				background-color: white;
				border-radius: 10px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
				overflow: hidden;
			}

			.story-header {
				background: linear-gradient(135deg, var(--primary), var(--secondary));
				color: white;
				padding: 20px;
				position: relative;
			}

			.story-title {
				font-size: 2rem;
				margin: 0 0 10px 0;
			}

			.story-theme {
				font-style: italic;
				font-size: 1.2rem;
				opacity: 0.9;
			}

			.story-content {
				padding: 30px;
			}

			.characters-section {
				margin-bottom: 30px;
			}

			.character-card {
				background-color: #f5f7fa;
				border-left: 5px solid var(--primary);
				padding: 15px;
				margin-bottom: 15px;
				border-radius: 5px;
			}

			.character-name {
				font-weight: 700;
				font-size: 1.2rem;
				margin: 0 0 10px 0;
			}

			.character-desc {
				margin: 0;
			}

			.scenes-section h2 {
				margin-top: 30px;
				border-bottom: 2px solid var(--primary);
				padding-bottom: 10px;
			}

			.scene-card {
				margin-bottom: 40px;
				border: 1px solid #ddd;
				border-radius: 8px;
				overflow: hidden;
			}

			.scene-header {
				background-color: #f5f7fa;
				padding: 15px;
				border-bottom: 1px solid #ddd;
			}

			.scene-title {
				margin: 0;
				font-size: 1.5rem;
			}

			.scene-content {
				padding: 20px;
			}

			.scene-image {
				width: 100%;
				max-width: 500px;
				height: auto;
				display: block;
				margin: 0 auto 20px auto;
				border-radius: 5px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}

			.scene-description {
				margin-bottom: 20px;
			}

			.scene-narration {
				font-style: italic;
				background-color: #f5f7fa;
				padding: 15px;
				border-radius: 5px;
				border-left: 5px solid var(--success);
			}

			.btn-container {
				margin-top: 30px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: 15px;
			}

			.download-buttons {
				display: flex;
				gap: 10px;
			}

			.btn-download {
				background-color: var(--success);
				padding: 10px 20px;
				font-size: 16px;
			}

			.btn-download:hover {
				background-color: #3aa7d9;
			}

			.scene-image {
				width: 100%;
				max-width: 500px;
				height: auto;
				display: block;
				margin: 0 auto 20px auto;
				border-radius: 5px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}

			.btn-download {
				background-color: var(--success);
				padding: 10px 20px;
				font-size: 16px;
			}

			.btn-download:hover {
				background-color: #3aa7d9;
			}

			.btn-back {
				background-color: #6c757d;
				padding: 10px 20px;
			}

			.error-message {
				background-color: #ffebee;
				color: var(--error);
				padding: 15px;
				border-radius: 5px;
				margin-bottom: 20px;
				display: none;
			}

			@media (max-width: 768px) {
				.container {
					padding: 15px;
				}

				header {
					padding: 15px 0;
				}

				h1 {
					font-size: 2rem;
				}

				.scene-image {
					max-height: 300px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<h1>AI Story Generator</h1>
				<p class="tagline">Transform your ideas into illustrated stories with AI</p>
			</header>

			<div class="generator-form" id="generatorForm">
				<div class="error-message" id="errorMessage"></div>

				<div class="form-group">
					<label for="storyPrompt">Describe your story idea:</label>
					<textarea id="storyPrompt" placeholder="Enter a detailed description of your story idea..."></textarea>
				</div>

				<div class="form-group">
					<label for="sceneCount">Number of scenes (1-10):</label>
					<input type="number" id="sceneCount" min="1" max="10" value="3" />
				</div>

				<div class="form-group">
					<label for="storyType">Select story type:</label>
					<select id="storyType">
						<option value="Analysis - Detailed examination of the topic">Analysis - Detailed examination of the topic</option>
						<option value="Storytelling - Narrative approach to the topic">Storytelling - Narrative approach to the topic</option>
						<option value="Poetry Illustration - Artistic interpretation">Poetry Illustration - Artistic interpretation</option>
					</select>
				</div>
				

				<button id="generateBtn">Generate Story</button>
			</div>

			<div class="loading" id="loadingIndicator">
				<div class="spinner"></div>
				<p>Creating your story... This may take a minute.</p>
			</div>

			<div class="story-container" id="storyContainer">
				<div class="story-header">
					<h2 class="story-title" id="storyTitle">Your Story Title</h2>
					<p class="story-theme" id="storyTheme">Theme: Adventure</p>
				</div>

				<div class="story-content">
					<div class="characters-section">
						<h2>Characters</h2>
						<div id="charactersContainer"></div>
					</div>

					<div class="scenes-section">
						<h2>Scenes</h2>
						<div id="scenesContainer"></div>
					</div>

					<div class="btn-container">
						<button class="btn-back" id="backBtn">Create Another Story</button>
						<div class="download-buttons">
							<button class="btn-download" id="downloadJsonBtn">Download Story JSON</button>
							<button class="btn-download" id="downloadImagesBtn">Download Images</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener('DOMContentLoaded', function () {
				const generatorForm = document.getElementById('generatorForm');
				const loadingIndicator = document.getElementById('loadingIndicator');
				const storyContainer = document.getElementById('storyContainer');
				const generateBtn = document.getElementById('generateBtn');
				const backBtn = document.getElementById('backBtn');
				const errorMessage = document.getElementById('errorMessage');
				const downloadJsonBtn = document.getElementById('downloadJsonBtn');
				const downloadImagesBtn = document.getElementById('downloadImagesBtn');
			
				const storyTitle = document.getElementById('storyTitle');
				const storyTheme = document.getElementById('storyTheme');
				const charactersContainer = document.getElementById('charactersContainer');
				const scenesContainer = document.getElementById('scenesContainer');
			
				let generatedStory = null;
			
				function showLoading() {
					generatorForm.style.display = 'none';
					errorMessage.style.display = 'none';
					storyContainer.style.display = 'none';
					loadingIndicator.style.display = 'block';
				}
			
				function showStory() {
					loadingIndicator.style.display = 'none';
					storyContainer.style.display = 'block';
				}
			
				function resetForm() {
					generatorForm.style.display = 'block';
					storyContainer.style.display = 'none';
					errorMessage.style.display = 'none';
				}
			
				generateBtn.addEventListener('click', async () => {
					const topic = document.getElementById('storyPrompt').value.trim();
					const sceneCount = parseInt(document.getElementById('sceneCount').value);
					const type=document.getElementById('storyType').value;	

					if (!topic || isNaN(sceneCount) || sceneCount < 1 || sceneCount > 10) {
						errorMessage.textContent = 'Please provide a valid story topic and scene count (1-10).';
						errorMessage.style.display = 'block';
						return;
					}
			
					showLoading();
			
					try {
						// Gọi endpoint generate content 
						const contentRes = await fetch('/api/generate/content', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ topic, type, sceneCount })
						});
			
						if (!contentRes.ok) {
							throw new Error('Failed to generate story content.');
						}
			
						const { story } = await contentRes.json();
						generatedStory = story;
			
						// Gọi endpoint generate images
						const imageRes = await fetch('/api/generate/images', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ scenes: story.scenes })
						});
			
						if (!imageRes.ok) {
							throw new Error('Failed to generate images.');
						}
			
						const { images } = await imageRes.json();
			
						// Gán imageUrl vào story
						story.scenes.forEach((scene, index) => {
							scene.imageUrl = images[index];
						});
			
						// Hiển thị nội dung
						storyTitle.textContent = story.prompt || 'AI-generated Story';
						storyTheme.textContent = story.theme ? 'Theme: ' + story.theme : '';
			
						// Characters
						charactersContainer.innerHTML = '';
						(story.characters || []).forEach(character => {
							const card = document.createElement('div');
							card.className = 'character-card';
							card.innerHTML = `
								<p class="character-name">${character.name}</p>
								<p class="character-desc">${character.description}</p>
							`;
							charactersContainer.appendChild(card);
						});
			
						// Scenes
						scenesContainer.innerHTML = '';
						(story.scenes || []).forEach(scene => {
							const sceneCard = document.createElement('div');
							sceneCard.className = 'scene-card';
							sceneCard.innerHTML = `
								<div class="scene-header">
									<h3 class="scene-title">${scene.title || 'Untitled Scene'}</h3>
								</div>
								<div class="scene-content">
									<img class="scene-image" src="${scene.imageUrl}" alt="Scene Image" />
									<p class="scene-description">${scene.description}</p>
									<div class="scene-narration">${scene.narration}</div>
								</div>
							`;
							scenesContainer.appendChild(sceneCard);
						});
			
						showStory();
					} catch (error) {
						errorMessage.textContent = error.message || 'An error occurred.';
						errorMessage.style.display = 'block';
						resetForm();
					}
				});
			
				backBtn.addEventListener('click', () => {
					resetForm();
				});
			
				downloadJsonBtn.addEventListener('click', () => {
					if (!generatedStory) return;
					const blob = new Blob([JSON.stringify(generatedStory, null, 2)], { type: 'application/json' });
					const link = document.createElement('a');
					link.href = URL.createObjectURL(blob);
					link.download = 'ai-story.json';
					document.body.appendChild(link);
					link.click();
					document.body.removeChild(link);
				});
			
				downloadImagesBtn.addEventListener('click', () => {
					if (!generatedStory?.scenes) return;
					generatedStory.scenes.forEach((scene, index) => {
						const link = document.createElement('a');
						link.href = scene.imageUrl;
						link.download = `scene-${index + 1}.jpg`;
						document.body.appendChild(link);
						link.click();
						document.body.removeChild(link);
					});
				});
			});
			</script>
	</body>
</html>
